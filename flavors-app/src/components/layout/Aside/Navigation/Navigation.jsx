import { useContext, useEffect, useState } from "react";
import { Link } from "react-router-dom";
import { useAuth } from "@context/AuthContext";
import ConfirmModal from "../../../modal/ConfirmModal/ConfirmModal";

export default function Navigation() {
  const { logout } = useAuth();
  const username = JSON.parse(localStorage.getItem("user_data")).username
  const [isModalOpen, setIsModalOpen] = useState(false); // Состояние модального окна
  const [action, setAction] = useState(null); // Действие, которое нужно подтвердить

  // Открыть модальное окно
  const openModal = (action) => {
    setAction(action); // Сохраняем действие
    setIsModalOpen(true); // Открываем модальное окно
  };

  // Закрыть модальное окно
  const closeModal = () => {
    setIsModalOpen(false);
  };

  // Обработка подтверждения
  const handleConfirm = () => {
    if (action === 'logout') {
      logout()
    }
    closeModal(); // Закрываем модальное окно
  };

  // Обработка отмены
  const handleCancel = () => {
    closeModal(); // Закрываем модальное окно
  };

  const jsSelectors = {
    button: "[data-js-button]",
    list: "[data-js-list]",
  }
  useEffect(() => {
    document.querySelectorAll(jsSelectors.button).forEach((button, index) => {
      if (button.dataset.jsButton == location.pathname) {
        button.classList.add("is-active")
      }
    }, [])

  }, [])
  function removeAllIsActive(event) {
    const listButton = event.target.closest(jsSelectors.list)
    listButton.childNodes.forEach(element => {
      const button = element.querySelector(jsSelectors.button)
      button.classList.remove("is-active")
    });
  }
  function buttonClick(event) {
    removeAllIsActive(event)
    const button = event.target.closest(".navigation__button")
    button.classList.add("is-active")
  }
  return (
    <nav className="navigation">
      <ul className="navigation__list" data-js-list="">
        <li className="navigation__item">
          <Link to="/account">
            <button
              className="navigation__button"
              title="Home"
              onClick={buttonClick}
              data-js-button="/account">
              <svg className="navigation__icon" width="50" height="47" viewBox="0 0 50 47" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path fillRule="evenodd" clipRule="evenodd" d="M26.305 0.966248L49.36 21.9912L46.7862 24.565L43.125 21.2445V44.9012L41.3125 46.7137H30.4375L28.625 44.9012V32.2137H21.375V44.9012L19.5625 46.7137H8.6875L6.875 44.9012V21.2735L3.25 24.565L0.676247 21.9912L23.695 0.966248H26.305ZM10.5 17.9784V43.0887H17.75V30.4012L19.5625 28.5887H30.4375L32.25 30.4012V43.0887H39.5V17.9566L25 4.80875L10.5 17.9784Z" fill="white" />
              </svg>
            </button>
          </Link>
        </li>
        <li className="navigation__item">
          <Link to="/messages">
            <button className="navigation__button" title="Chats" onClick={buttonClick} data-js-button="/messages">
              <svg className="navigation__icon" width="46" height="45" viewBox="0 0 46 45" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M39.0995 6.80432C35.401 3.19496 30.5196 0.949819 25.2968 0.455958C20.074 -0.0379027 14.8371 1.25047 10.489 4.09896C6.14091 6.94744 2.95409 11.1775 1.47794 16.06C0.00178736 20.9424 0.328819 26.1712 2.40265 30.8449C2.6188 31.2793 2.68972 31.7683 2.60552 32.2436L0.621908 41.4883C0.545486 41.8427 0.561091 42.21 0.667323 42.5572C0.773555 42.9043 0.967084 43.2204 1.23052 43.4771C1.44647 43.685 1.7036 43.8483 1.9864 43.9572C2.2692 44.0661 2.57182 44.1184 2.87601 44.1109H3.32684L12.9744 42.2314C13.4647 42.1742 13.962 42.242 14.417 42.4281C19.2374 44.4388 24.6304 44.7559 29.666 43.3246C34.7017 41.8934 39.0646 38.8036 42.0025 34.5878C44.9404 30.3721 46.2692 25.2946 45.7598 20.2307C45.2505 15.1669 42.9349 10.434 39.2122 6.84803L39.0995 6.80432ZM14.1465 24.4414C13.7007 24.4414 13.2649 24.3132 12.8942 24.073C12.5235 23.8329 12.2346 23.4916 12.064 23.0922C11.8934 22.6929 11.8488 22.2534 11.9358 21.8295C12.0227 21.4055 12.2374 21.0161 12.5527 20.7105C12.8679 20.4048 13.2695 20.1967 13.7068 20.1123C14.144 20.028 14.5973 20.0713 15.0092 20.2367C15.421 20.4021 15.7731 20.6822 16.0208 21.0416C16.2684 21.4011 16.4007 21.8236 16.4007 22.2559C16.4007 22.8355 16.1632 23.3914 15.7404 23.8012C15.3177 24.2111 14.7444 24.4414 14.1465 24.4414ZM23.163 24.4414C22.7171 24.4414 22.2813 24.3132 21.9107 24.073C21.54 23.8329 21.2511 23.4916 21.0804 23.0922C20.9098 22.6929 20.8652 22.2534 20.9522 21.8295C21.0392 21.4055 21.2538 21.0161 21.5691 20.7105C21.8843 20.4048 22.286 20.1967 22.7232 20.1123C23.1605 20.028 23.6137 20.0713 24.0256 20.2367C24.4375 20.4021 24.7895 20.6822 25.0372 21.0416C25.2849 21.4011 25.4171 21.8236 25.4171 22.2559C25.4171 22.8355 25.1796 23.3914 24.7569 23.8012C24.3341 24.2111 23.7608 24.4414 23.163 24.4414ZM32.1794 24.4414C31.7336 24.4414 31.2978 24.3132 30.9271 24.073C30.5564 23.8329 30.2675 23.4916 30.0969 23.0922C29.9263 22.6929 29.8816 22.2534 29.9686 21.8295C30.0556 21.4055 30.2703 21.0161 30.5855 20.7105C30.9007 20.4048 31.3024 20.1967 31.7396 20.1123C32.1769 20.028 32.6301 20.0713 33.042 20.2367C33.4539 20.4021 33.8059 20.6822 34.0536 21.0416C34.3013 21.4011 34.4335 21.8236 34.4335 22.2559C34.4335 22.8355 34.196 23.3914 33.7733 23.8012C33.3506 24.2111 32.7772 24.4414 32.1794 24.4414Z" fill="white" />
              </svg>
            </button>
          </Link>
        </li>
        <li className="navigation__item">
          <Link to="/notifications">
            <button className="navigation__button" title="Notifications" onClick={buttonClick} data-js-button="/notifications">
              <svg className="navigation__icon" width="43" height="49" viewBox="0 0 43 49" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M38.125 28.2668V19.75C38.125 12.1096 32.9356 5.67337 25.9056 3.73775C25.2098 1.985 23.5093 0.75 21.5 0.75C19.4908 0.75 17.7903 1.985 17.0944 3.73775C10.0644 5.67575 4.875 12.1096 4.875 19.75V28.2668L0.820877 32.3209C0.599901 32.5411 0.424655 32.8028 0.305228 33.0909C0.1858 33.3791 0.12455 33.6881 0.125002 34V38.75C0.125002 39.3799 0.375225 39.984 0.820624 40.4294C1.26602 40.8748 1.87011 41.125 2.5 41.125H40.5C41.1299 41.125 41.734 40.8748 42.1794 40.4294C42.6248 39.984 42.875 39.3799 42.875 38.75V34C42.8755 33.6881 42.8142 33.3791 42.6948 33.0909C42.5754 32.8028 42.4001 32.5411 42.1791 32.3209L38.125 28.2668ZM38.125 36.375H4.875V34.9832L8.92913 30.9291C9.1501 30.7089 9.32535 30.4472 9.44478 30.1591C9.56421 29.8709 9.62546 29.5619 9.625 29.25V19.75C9.625 13.2021 14.9521 7.875 21.5 7.875C28.0479 7.875 33.375 13.2021 33.375 19.75V29.25C33.375 29.8818 33.6244 30.485 34.0709 30.9291L38.125 34.9832V36.375ZM21.5 48.25C22.9708 48.2519 24.4057 47.7954 25.6052 46.9441C26.8046 46.0929 27.7091 44.889 28.1928 43.5H14.8073C15.291 44.889 16.1954 46.0929 17.3948 46.9441C18.5943 47.7954 20.0292 48.2519 21.5 48.25Z" fill="white" />
              </svg>
            </button>
          </Link>
        </li>
        <li className="navigation__item">
          <Link to="/options">
            <button className="navigation__button" title="Option" onClick={buttonClick} data-js-button="/options">
              <svg className="navigation__icon" width="43" height="45" viewBox="0 0 43 45" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M25.5192 44.5833H17.4808C16.9772 44.5834 16.4886 44.4113 16.0962 44.0956C15.7038 43.7799 15.4311 43.3396 15.3233 42.8476L14.4245 38.6871C13.2255 38.1617 12.0886 37.5048 11.0347 36.7283L6.978 38.0202C6.49783 38.1733 5.97972 38.1576 5.50972 37.9756C5.03973 37.7936 4.64611 37.4563 4.39425 37.0198L0.366252 30.0613C0.117031 29.6244 0.0234795 29.1158 0.100903 28.6187C0.178327 28.1217 0.422142 27.6656 0.79246 27.3252L3.93933 24.4544C3.79623 23.1539 3.79623 21.8417 3.93933 20.5412L0.79246 17.677C0.421617 17.3364 0.177471 16.8799 0.100035 16.3824C0.0225981 15.8849 0.116465 15.3758 0.366252 14.9387L4.38542 7.97578C4.63728 7.53923 5.03089 7.20196 5.50089 7.01999C5.97089 6.83801 6.489 6.82228 6.96917 6.97541L11.0259 8.26728C11.5647 7.86978 12.1256 7.49878 12.7042 7.16312C13.2629 6.84953 13.8371 6.56466 14.4245 6.3107L15.3255 2.15461C15.4328 1.66259 15.705 1.22201 16.097 0.90591C16.489 0.589812 16.9773 0.417186 17.4808 0.416656H25.5192C26.0227 0.417186 26.511 0.589812 26.903 0.90591C27.295 1.22201 27.5672 1.66259 27.6745 2.15461L28.5843 6.31291C29.7826 6.83827 30.9188 7.49523 31.9719 8.2717L36.0308 6.97982C36.5107 6.82726 37.0283 6.84328 37.4978 7.02523C37.9674 7.20717 38.3606 7.54412 38.6124 7.9802L42.6315 14.9431C43.1439 15.8419 42.9672 16.9792 42.2053 17.6792L39.0585 20.55C39.2016 21.8505 39.2016 23.1627 39.0585 24.4632L42.2053 27.334C42.9672 28.0363 43.1439 29.1714 42.6315 30.0702L38.6124 37.033C38.3605 37.4696 37.9669 37.8069 37.4969 37.9888C37.0269 38.1708 36.5088 38.1865 36.0286 38.0334L31.9719 36.7415C30.9188 37.5174 29.7826 38.1737 28.5843 38.6981L27.6745 42.8476C27.5668 43.3392 27.2944 43.7793 26.9024 44.0949C26.5105 44.4106 26.0224 44.5829 25.5192 44.5833ZM11.8275 31.839L13.6383 33.164C14.0469 33.4644 14.4709 33.7404 14.9125 33.9922C15.3277 34.2329 15.7517 34.4493 16.1912 34.6458L18.2515 35.549L19.2608 40.1667H23.7437L24.7529 35.5468L26.8133 34.6436C27.712 34.2461 28.5667 33.7537 29.3595 33.1729L31.1703 31.8479L35.6797 33.2833L37.9212 29.401L34.4254 26.2144L34.6727 23.9796C34.7831 23.0013 34.7831 22.0142 34.6727 21.0381L34.4254 18.8032L37.9234 15.61L35.6797 11.7255L31.1725 13.1609L29.3595 11.8359C28.5662 11.2523 27.7126 10.7555 26.8133 10.3542L24.7529 9.45095L23.7437 4.83332H19.2608L18.2449 9.45316L16.1912 10.3542C15.2906 10.7486 14.4366 11.2419 13.645 11.8249L11.8319 13.1499L7.32692 11.7145L5.08104 15.61L8.57683 18.7922L8.3295 21.0292C8.21908 22.0075 8.21908 22.9947 8.3295 23.9707L8.57683 26.2056L5.08104 29.3922L7.3225 33.2744L11.8275 31.839ZM21.4912 31.3333C19.1484 31.3333 16.9016 30.4027 15.2451 28.7461C13.5885 27.0895 12.6578 24.8427 12.6578 22.5C12.6578 20.1572 13.5885 17.9105 15.2451 16.2539C16.9016 14.5973 19.1484 13.6667 21.4912 13.6667C23.8339 13.6667 26.0807 14.5973 27.7373 16.2539C29.3938 17.9105 30.3245 20.1572 30.3245 22.5C30.3245 24.8427 29.3938 27.0895 27.7373 28.7461C26.0807 30.4027 23.8339 31.3333 21.4912 31.3333ZM21.4912 18.0833C20.6263 18.0842 19.7807 18.339 19.0593 18.8161C18.3379 19.2932 17.7725 19.9715 17.4331 20.7671C17.0938 21.5626 16.9955 22.4403 17.1504 23.2911C17.3053 24.142 17.7067 24.9287 18.3046 25.5536C18.9026 26.1784 19.6709 26.614 20.5141 26.8062C21.3574 26.9984 22.2385 26.9388 23.0482 26.6348C23.8579 26.3308 24.5605 25.7957 25.0688 25.096C25.5772 24.3963 25.8689 23.5627 25.9078 22.6987V23.5821V22.5C25.9078 21.3286 25.4425 20.2052 24.6142 19.3769C23.7859 18.5487 22.6625 18.0833 21.4912 18.0833Z" fill="white" />
              </svg>
            </button>
          </Link>
        </li>
        <li className="navigation__item">
          <button className="navigation__button" title="Exit" data-js-button="" onClick={() => {
            openModal('logout')
          }}>
            <svg className="navigation__icon" width="46" height="48" viewBox="0 0 46 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fillRule="evenodd" clipRule="evenodd" d="M18.8105 1.08378C19.8183 0.781453 20.8828 0.718913 21.9191 0.901148C22.9554 1.08338 23.9347 1.50535 24.7789 2.13336C25.6231 2.76137 26.3088 3.57803 26.7812 4.51816C27.2537 5.45829 27.4998 6.49586 27.5 7.54803V40.452C27.4998 41.5042 27.2537 42.5418 26.7812 43.4819C26.3088 44.422 25.6231 45.2387 24.7789 45.8667C23.9347 46.4947 22.9554 46.9167 21.9191 47.0989C20.8828 47.2811 19.8183 47.2186 18.8105 46.9163L5.3105 42.8663C3.92023 42.4492 2.70142 41.5951 1.83488 40.4307C0.968346 39.2662 0.500238 37.8535 0.5 36.402V11.598C0.500238 10.1465 0.968346 8.7338 1.83488 7.56937C2.70142 6.40493 3.92023 5.55084 5.3105 5.13378L18.8105 1.08378ZM29.75 6.00003C29.75 5.40329 29.987 4.83099 30.409 4.40904C30.831 3.98708 31.4033 3.75003 32 3.75003H38.75C40.5402 3.75003 42.2571 4.46119 43.523 5.72706C44.7888 6.99293 45.5 8.70981 45.5 10.5V12.75C45.5 13.3468 45.2629 13.9191 44.841 14.341C44.419 14.763 43.8467 15 43.25 15C42.6533 15 42.081 14.763 41.659 14.341C41.237 13.9191 41 13.3468 41 12.75V10.5C41 9.90329 40.7629 9.33099 40.341 8.90904C39.919 8.48708 39.3467 8.25003 38.75 8.25003H32C31.4033 8.25003 30.831 8.01297 30.409 7.59102C29.987 7.16906 29.75 6.59676 29.75 6.00003ZM43.25 33C43.8467 33 44.419 33.2371 44.841 33.659C45.2629 34.081 45.5 34.6533 45.5 35.25V37.5C45.5 39.2902 44.7888 41.0071 43.523 42.273C42.2571 43.5389 40.5402 44.25 38.75 44.25H32C31.4033 44.25 30.831 44.013 30.409 43.591C29.987 43.1691 29.75 42.5968 29.75 42C29.75 41.4033 29.987 40.831 30.409 40.409C30.831 39.9871 31.4033 39.75 32 39.75H38.75C39.3467 39.75 39.919 39.513 40.341 39.091C40.7629 38.6691 41 38.0968 41 37.5V35.25C41 34.6533 41.237 34.081 41.659 33.659C42.081 33.2371 42.6533 33 43.25 33ZM16.25 21.75C15.6533 21.75 15.081 21.9871 14.659 22.409C14.2371 22.831 14 23.4033 14 24C14 24.5968 14.2371 25.1691 14.659 25.591C15.081 26.013 15.6533 26.25 16.25 26.25H16.2522C16.849 26.25 17.4213 26.013 17.8432 25.591C18.2652 25.1691 18.5022 24.5968 18.5022 24C18.5022 23.4033 18.2652 22.831 17.8432 22.409C17.4213 21.9871 16.849 21.75 16.2522 21.75H16.25Z" fill="white" />
            </svg>
          </button>
        </li>
      </ul>
      {/* Модальное окно */}
      <ConfirmModal
        isOpen={isModalOpen}
        message={`Выйти из аккаунта ${username}?`}
        onConfirm={handleConfirm}
        onCancel={handleCancel}
      />
    </nav>
  )
}